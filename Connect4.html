<html>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.0/jquery.min.js"></script>
<style>
body{
    margin:20px;
}
</style>
<body>
<canvas id="Canvas" width= "700px" height = "700px">
Your browser does not support the canvas element.
</canvas>
<br>

<button type = "button" id = "restart">Restart</button>
</body>
<script>
//canvas and context are used to manipulate the screen
var canvas = document.getElementById("Canvas");
var context = canvas.getContext("2d");
//width and height are dimensions of the grid (game)
var width = 7;
var height = 6;
//offset for the area above the game for buttons
var vOffset = 100;
// the dimensions for each piece of the grid. should be a square but calculating just in case. 
var vSize = 600/height;
var hSize = 700/width;
// grid that stores the game state. might want to switch to an object if we want to store more information
var grid;
// the current player. using p1 and p2 because its more readable than true/false. 

var turn;
// if there is a current game going on. useful for handling actions if the game is over. 
var CurrentGame = false;
CreateWorld()
//sets the player, sets the current game state, initializes the grid and then displays it. 
function CreateWorld(){
    turn = 0;
    CurrentGame = true;
    grid = createGrid(width, height);
    display(grid);
    
}
// just creates a grid with the input dimensions and puts a "_" for each starting position showing that it is available. 
function createGrid(width, height){
    var arr = []
    for(var i = 0; i < width; i++)
    {   
        arr.push([])
        for(var j = 0; j < height; j++){
			arr[i].push("_")
        }
    }

    return arr;
}
// this function has to be called every time the game state is updated. 
function display(grid){
	//draw a rectangle at the start
    context.fillStyle = "#AAAAAA";
    context.fillRect(0,vOffset, 700, 600 )
    context.font = hSize + "px Arial";
    for(var x  = 0; x < grid.length; x++){
		//for each column draw a circle for the drop button
		context.fillStyle = "green";     
		context.beginPath();
		context.arc(x*hSize + hSize/2, vSize/2, hSize/3, 0, 2 * Math.PI, false);
		context.fill();
		context.fillStyle = 'green';
		context.lineWidth = 5;
		context.strokeStyle = '#003300';
		context.stroke();
        for(var y = 0; y < grid[0].length; y++){
            //for each x,y create the correct circle.(black, red, white)
			context.beginPath();
			context.arc(x*hSize + hSize/2,  y*vSize + vSize/2 + vOffset, hSize/3, 0, 2 * Math.PI, false);
			if(grid[x][y] == "R"){context.fillStyle = 'red';}
			else if(grid[x][y] == "B"){context.fillStyle = 'black';}
			else{context.fillStyle = '#FFFFFF';}
			
			context.fill();
			
        }
    }

}

// all of the click commands
window.addEventListener('click', click, false);
function click(e){
    if(turn == "p2" || !CurrentGame){return;}
    var pos = getMousePos(canvas, e);
    var x = pos.x;
    var y = pos.y;
    if(x < 0 || x > 700){return;}
    if(y < 0 || y > 100){return;}
    var move = getMove(x,y);

	if(move == -1){return;}

    //make move and change turn if valid move.
	if(makeMove(grid, move, turn)){turn = (turn + 1 )%2;}
    else{return;}
    display(grid);

    calculateTurn();
   
    
}
function getMousePos(canvas, evt) {
    var rect = canvas.getBoundingClientRect();
    return {
      x: evt.clientX - rect.left,
      y: evt.clientY - rect.top
    };
}
function getMove(x,y){
	for(var i = 0; i < width; i++)
	{
		circleX = i * hSize + hSize/2; 
		circleY = vSize/2;
		diffX = circleX - x;
		diffY = circleY - y
		if(Math.sqrt(diffX * diffX + diffY * diffY )  < hSize /3)
		{
			return i;
		}
	}
    return -1;
}
function makeMove(game, move, currentTurn){

	var color = getColor(currentTurn)
	for(var i = game[move].length-1; i >= 0; i-- ){
		if(game[move][i] == "_")
		{
            
			game[move][i] = color;
			return true;
		}
		
	}
    console.log("failed to make move")
	return false;
}
//get the label to put in the grid for each player
function getColor(turn){
	if(turn == 0){return "R";}
	else if (turn == 1){return "B"}
	else{return "_"}
}

function getMoves(game){
    var moves = [];
    for( var i = 0; i < width; i++){
        if(grid[i][0] == "_"){
            moves.push(i);
        }
    }
    return moves;

}
function calculateTurn(){
    var moves = getMoves(grid);
    var randomMove = Math.floor(Math.random()*moves.length);
    makeMove(grid, moves[randomMove], turn);
    turn = (turn + 1) %2
    display(grid);
    if(complete(grid)){alert("complete")}
}
//check if any moves left
function complete(grid){

    for(var i = 0; i < width; i++){
        if(grid[i][0] == "_"){return false;}
    }
    return true;
}
</script>
</html>


